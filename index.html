<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Detecção de Dispositivo e IP com Platform.js e Firebase</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/platform/1.3.6/platform.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; }
  .info { margin-top: 20px; }
</style>
</head>
<body>
<h1>Informações do Dispositivo e IP</h1>
<p><strong>IPv4:</strong> <span id="ipv4">Carregando...</span></p>
<p><strong>Sistema Operacional:</strong> <span id="os"></span></p>
<p><strong>Navegador:</strong> <span id="browser"></span></p>
<div class="info">
  <!-- Outras informações podem ser exibidas aqui -->
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, set, push } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  const firebaseConfig = {
    // Sua configuração do Firebase
  };

  // Inicializa o Firebase
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // Função para obter o IPv4 real do usuário
  function getRealIP() {
    fetch('https://api.ipify.org?format=json')
      .then(function(response) {
        return response.json();
      })
      .then(function(data) {
        const ip = data.ip;
        document.getElementById('ipv4').textContent = ip;
        // Obter informações do dispositivo usando Platform.js
        const os = platform.os.family + ' ' + (platform.os.version || '');
        const browser = platform.name + ' ' + (platform.version || '');
        document.getElementById('os').textContent = os;
        document.getElementById('browser').textContent = browser;
        saveInfoToFirebase(ip, os, browser);
      })
      .catch(function(error) {
        console.log('Erro ao obter o IPv4:', error);
      });
  }

  // Função para salvar informações no Firebase
  function saveInfoToFirebase(ip, os, browser) {
    const infoRef = ref(db, 'user_info');
    const newInfoRef = push(infoRef);
    set(newInfoRef, {
      ip: ip,
      os: os,
      browser: browser,
      timestamp: Date.now() // Usando o timestamp como identificador único
    });
  }

  // Chamada da função ao carregar a página
  window.onload = getRealIP;
</script>
</body>
</html>
