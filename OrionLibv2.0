--[[ 
    EXTREME ORION LIB - FINAL VERSION (GOLD MASTER)
    Compatibilidade: Delta, Arceus X, Fluxus, Hydrogen (Mobile & PC)
]]

local OrionLib = {}

-- // Services
local Player = game:GetService("Players").LocalPlayer
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local RunService = game:GetService("RunService")

-- // Internal Variables
local Viewport = (RunService:IsStudio() and Player.PlayerGui) or CoreGui
local OrionGUI
local ConfigData = {} 
local ConfigFileName = "ExtremeHub_Config.json"
local SaveEnabled = false 
local CurrentKeybind = Enum.KeyCode.RightControl

-- // Theme Configuration
local Theme = {
    Main = Color3.fromRGB(245, 245, 250),       
    Secondary = Color3.fromRGB(255, 255, 255),  
    Stroke = Color3.fromRGB(200, 200, 220),     
    Text = Color3.fromRGB(40, 40, 60),          
    Accent = Color3.fromRGB(0, 120, 255)      
}

-- // Save System
local function SaveSettings()
    if not SaveEnabled then return end
    ConfigData["_Keybind"] = CurrentKeybind.Name
    if writefile then
        writefile(ConfigFileName, HttpService:JSONEncode(ConfigData))
    end
end

local function LoadSettings()
    if readfile and isfile and isfile(ConfigFileName) then
        local Success, Decoded = pcall(function()
            return HttpService:JSONDecode(readfile(ConfigFileName))
        end)
        if Success then
            ConfigData = Decoded
            if ConfigData["_Keybind"] then
                local KeyName = ConfigData["_Keybind"]
                if Enum.KeyCode[KeyName] then CurrentKeybind = Enum.KeyCode[KeyName] end
            end
            return ConfigData
        end
    end
    return {}
end

-- // Utility: Dragging
local function MakeDraggable(topbarobject, object)
    local Dragging, DragInput, DragStart, StartPosition
    local function Update(input)
        local Delta = input.Position - DragStart
        local newPos = UDim2.new(StartPosition.X.Scale, StartPosition.X.Offset + Delta.X, StartPosition.Y.Scale, StartPosition.Y.Offset + Delta.Y)
        TweenService:Create(object, TweenInfo.new(0.15), {Position = newPos}):Play()
    end
    topbarobject.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            Dragging = true
            DragStart = input.Position
            StartPosition = object.Position
            input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then Dragging = false end end)
        end
    end)
    topbarobject.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then DragInput = input end
    end)
    UserInputService.InputChanged:Connect(function(input) if input == DragInput and Dragging then Update(input) end end)
end

-- // Main Window Function
function OrionLib:MakeWindow(Settings)
    if CoreGui:FindFirstChild(Settings.Name or "ExtremeHub") then
        CoreGui:FindFirstChild(Settings.Name or "ExtremeHub"):Destroy()
    end

    if Settings.ConfigName then ConfigFileName = Settings.ConfigName .. ".json" end
    LoadSettings()

    OrionGUI = Instance.new("ScreenGui")
    OrionGUI.Name = Settings.Name or "ExtremeHub"
    OrionGUI.Parent = Viewport
    OrionGUI.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

    local MainFrame = Instance.new("Frame")
    MainFrame.Name = "MainFrame"
    MainFrame.Parent = OrionGUI
    MainFrame.BackgroundColor3 = Theme.Main
    MainFrame.Position = UDim2.new(0.5, -250, 0.5, -175)
    MainFrame.Size = UDim2.new(0, 500, 0, 350)
    MainFrame.ClipsDescendants = true
    Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 10)
    
    local UIStroke = Instance.new("UIStroke")
    UIStroke.Parent = MainFrame
    UIStroke.Color = Theme.Accent
    UIStroke.Thickness = 1.5
    UIStroke.Transparency = 0.2

    -- Topbar
    local Topbar = Instance.new("Frame")
    Topbar.Parent = MainFrame
    Topbar.BackgroundColor3 = Theme.Secondary
    Topbar.Size = UDim2.new(1, 0, 0, 40)
    Instance.new("UICorner", Topbar).CornerRadius = UDim.new(0, 10)

    local Title = Instance.new("TextLabel")
    Title.Parent = Topbar
    Title.BackgroundTransparency = 1
    Title.Position = UDim2.new(0, 15, 0, 0)
    Title.Size = UDim2.new(1, -30, 1, 0)
    Title.Font = Enum.Font.GothamBold
    Title.Text = Settings.Name or "Hub"
    Title.TextColor3 = Theme.Accent
    Title.TextSize = 18
    Title.TextXAlignment = Enum.TextXAlignment.Left

    MakeDraggable(Topbar, MainFrame)

    -- PC Keybind Logic
    UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if not gameProcessed and input.KeyCode == CurrentKeybind then
            MainFrame.Visible = not MainFrame.Visible
        end
    end)

    -- Mobile Toggle Logic
    if UserInputService.TouchEnabled or Settings.MobileFriendly then
        local ToggleBtn = Instance.new("ImageButton")
        ToggleBtn.Name = "MobileToggle"
        ToggleBtn.Parent = OrionGUI
        ToggleBtn.BackgroundColor3 = Theme.Accent
        ToggleBtn.Position = UDim2.new(0.9, -50, 0.2, 0)
        ToggleBtn.Size = UDim2.new(0, 50, 0, 50)
        ToggleBtn.Image = "rbxassetid://3926305904"
        Instance.new("UICorner", ToggleBtn).CornerRadius = UDim.new(1, 0)
        MakeDraggable(ToggleBtn, ToggleBtn)
        ToggleBtn.MouseButton1Click:Connect(function() MainFrame.Visible = not MainFrame.Visible end)
    end

    local TabContainer = Instance.new("ScrollingFrame")
    TabContainer.Parent = MainFrame
    TabContainer.BackgroundColor3 = Theme.Main
    TabContainer.BackgroundTransparency = 1
    TabContainer.Position = UDim2.new(0, 10, 0, 50)
    TabContainer.Size = UDim2.new(0, 120, 1, -60)
    TabContainer.ScrollBarThickness = 0
    Instance.new("UIListLayout", TabContainer).Padding = UDim.new(0, 5)

    local Pages = Instance.new("Frame")
    Pages.Parent = MainFrame
    Pages.BackgroundTransparency = 1
    Pages.Position = UDim2.new(0, 140, 0, 50)
    Pages.Size = UDim2.new(1, -150, 1, -60)

    local Window = {}

    function Window:MakeTab(TabSettings)
        local TabButton = Instance.new("TextButton")
        TabButton.Parent = TabContainer
        TabButton.BackgroundColor3 = Theme.Secondary
        TabButton.Size = UDim2.new(1, 0, 0, 35)
        TabButton.Font = Enum.Font.GothamMedium
        TabButton.Text = TabSettings.Name
        TabButton.TextColor3 = Theme.Text
        TabButton.TextSize = 14
        TabButton.AutoButtonColor = false
        Instance.new("UICorner", TabButton).CornerRadius = UDim.new(0, 6)
        
        local Page = Instance.new("ScrollingFrame")
        Page.Name = TabSettings.Name
        Page.Parent = Pages
        Page.BackgroundTransparency = 1
        Page.Size = UDim2.new(1, 0, 1, 0)
        Page.ScrollBarThickness = 2
        Page.Visible = false
        Instance.new("UIListLayout", Page).Padding = UDim.new(0, 5)

        if #Pages:GetChildren() == 1 then
            Page.Visible = true
            TabButton.BackgroundColor3 = Theme.Accent
            TabButton.TextColor3 = Color3.new(1,1,1)
        end

        TabButton.MouseButton1Click:Connect(function()
            for _, v in pairs(TabContainer:GetChildren()) do
                if v:IsA("TextButton") then
                    TweenService:Create(v, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Secondary, TextColor3 = Theme.Text}):Play()
                end
            end
            for _, v in pairs(Pages:GetChildren()) do v.Visible = false end
            TweenService:Create(TabButton, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Accent, TextColor3 = Color3.new(1,1,1)}):Play()
            Page.Visible = true
        end)

        local Tab = {}

        -- Element: Label
        function Tab:AddLabel(Text)
            local LabelFrame = Instance.new("Frame")
            LabelFrame.Parent = Page
            LabelFrame.BackgroundTransparency = 1
            LabelFrame.Size = UDim2.new(1, -5, 0, 25)
            local Lbl = Instance.new("TextLabel")
            Lbl.Parent = LabelFrame
            Lbl.BackgroundTransparency = 1
            Lbl.Size = UDim2.new(1, 0, 1, 0)
            Lbl.Font = Enum.Font.GothamBold
            Lbl.Text = Text
            Lbl.TextColor3 = Theme.Accent
            Lbl.TextSize = 14
        end

        -- Element: Button
        function Tab:AddButton(ButtonSettings)
            local ButtonFrame = Instance.new("Frame")
            ButtonFrame.Parent = Page
            ButtonFrame.BackgroundColor3 = Theme.Secondary
            ButtonFrame.Size = UDim2.new(1, -5, 0, 40)
            Instance.new("UICorner", ButtonFrame).CornerRadius = UDim.new(0, 6)
            
            local Btn = Instance.new("TextButton")
            Btn.Parent = ButtonFrame
            Btn.BackgroundTransparency = 1
            Btn.Size = UDim2.new(1, 0, 1, 0)
            Btn.Font = Enum.Font.Gotham
            Btn.Text = ButtonSettings.Name
            Btn.TextColor3 = Theme.Text
            Btn.TextSize = 14
            Btn.MouseButton1Click:Connect(function()
                pcall(ButtonSettings.Callback)
                TweenService:Create(ButtonFrame, TweenInfo.new(0.1), {BackgroundColor3 = Theme.Stroke}):Play()
                wait(0.1)
                TweenService:Create(ButtonFrame, TweenInfo.new(0.1), {BackgroundColor3 = Theme.Secondary}):Play()
            end)
        end

        -- Element: Toggle
        function Tab:AddToggle(ToggleSettings)
            local SavedValue = ToggleSettings.Default
            if ConfigData[ToggleSettings.Name] ~= nil then SavedValue = ConfigData[ToggleSettings.Name] end
            local ToggleFrame = Instance.new("Frame")
            ToggleFrame.Parent = Page
            ToggleFrame.BackgroundColor3 = Theme.Secondary
            ToggleFrame.Size = UDim2.new(1, -5, 0, 40)
            Instance.new("UICorner", ToggleFrame).CornerRadius = UDim.new(0, 6)
            local Title = Instance.new("TextLabel")
            Title.Parent = ToggleFrame
            Title.BackgroundTransparency = 1
            Title.Position = UDim2.new(0, 10, 0, 0)
            Title.Size = UDim2.new(0.7, 0, 1, 0)
            Title.Font = Enum.Font.Gotham
            Title.Text = ToggleSettings.Name
            Title.TextColor3 = Theme.Text
            Title.TextSize = 14
            Title.TextXAlignment = Enum.TextXAlignment.Left
            local Switch = Instance.new("TextButton")
            Switch.Parent = ToggleFrame
            Switch.BackgroundColor3 = Color3.fromRGB(200,200,200)
            Switch.Position = UDim2.new(1, -60, 0.5, -10)
            Switch.Size = UDim2.new(0, 40, 0, 20)
            Switch.Text = ""
            Instance.new("UICorner", Switch).CornerRadius = UDim.new(1, 0)
            local Knob = Instance.new("Frame")
            Knob.Parent = Switch
            Knob.BackgroundColor3 = Color3.new(1,1,1)
            Knob.Position = UDim2.new(0, 2, 0.5, -8)
            Knob.Size = UDim2.new(0, 16, 0, 16)
            Instance.new("UICorner", Knob).CornerRadius = UDim.new(1, 0)
            local Toggled = SavedValue
            local function UpdateToggle()
                if Toggled then
                    TweenService:Create(Switch, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Accent}):Play()
                    TweenService:Create(Knob, TweenInfo.new(0.2), {Position = UDim2.new(1, -18, 0.5, -8)}):Play()
                else
                    TweenService:Create(Switch, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(200,200,200)}):Play()
                    TweenService:Create(Knob, TweenInfo.new(0.2), {Position = UDim2.new(0, 2, 0.5, -8)}):Play()
                end
                ConfigData[ToggleSettings.Name] = Toggled
                SaveSettings()
                pcall(ToggleSettings.Callback, Toggled)
            end
            task.spawn(function()
                if SavedValue then UpdateToggle() else pcall(ToggleSettings.Callback, false) end
            end)
            Switch.MouseButton1Click:Connect(function() Toggled = not Toggled UpdateToggle() end)
        end

        -- Element: Dropdown
        function Tab:AddDropdown(DropdownSettings)
            local DropFrame = Instance.new("Frame")
            DropFrame.Parent = Page
            DropFrame.BackgroundColor3 = Theme.Secondary
            DropFrame.Size = UDim2.new(1, -5, 0, 40)
            DropFrame.ClipsDescendants = true
            Instance.new("UICorner", DropFrame).CornerRadius = UDim.new(0, 6)
            local Title = Instance.new("TextLabel")
            Title.Parent = DropFrame
            Title.BackgroundTransparency = 1
            Title.Position = UDim2.new(0, 10, 0, 0)
            Title.Size = UDim2.new(1, -40, 0, 40)
            Title.Font = Enum.Font.Gotham
            Title.Text = DropdownSettings.Name .. " - " .. (DropdownSettings.Default or "Select")
            Title.TextColor3 = Theme.Text
            Title.TextSize = 14
            Title.TextXAlignment = Enum.TextXAlignment.Left
            local Arrow = Instance.new("ImageLabel")
            Arrow.Parent = DropFrame
            Arrow.BackgroundTransparency = 1
            Arrow.Position = UDim2.new(1, -30, 0, 10)
            Arrow.Size = UDim2.new(0, 20, 0, 20)
            Arrow.Image = "rbxassetid://6034818372"
            Arrow.ImageColor3 = Theme.Text
            local Open = false
            local DropBtn = Instance.new("TextButton")
            DropBtn.Parent = DropFrame
            DropBtn.BackgroundTransparency = 1
            DropBtn.Size = UDim2.new(1, 0, 0, 40)
            DropBtn.Text = ""
            local OptionList = Instance.new("Frame")
            OptionList.Parent = DropFrame
            OptionList.BackgroundTransparency = 1
            OptionList.Position = UDim2.new(0, 0, 0, 40)
            OptionList.Size = UDim2.new(1, 0, 0, 0)
            local ListLayout = Instance.new("UIListLayout")
            ListLayout.Parent = OptionList
            ListLayout.SortOrder = Enum.SortOrder.LayoutOrder
            local function RefreshList()
                for _,v in pairs(OptionList:GetChildren()) do if v:IsA("TextButton") then v:Destroy() end end
                for _, Option in pairs(DropdownSettings.Options) do
                    local OptBtn = Instance.new("TextButton")
                    OptBtn.Parent = OptionList
                    OptBtn.BackgroundColor3 = Theme.Main
                    OptBtn.Size = UDim2.new(1, 0, 0, 30)
                    OptBtn.Font = Enum.Font.Gotham
                    OptBtn.Text = Option
                    OptBtn.TextColor3 = Theme.Text
                    OptBtn.TextSize = 13
                    OptBtn.MouseButton1Click:Connect(function()
                        Open = false
                        Title.Text = DropdownSettings.Name .. " - " .. Option
                        TweenService:Create(DropFrame, TweenInfo.new(0.2), {Size = UDim2.new(1, -5, 0, 40)}):Play()
                        TweenService:Create(Arrow, TweenInfo.new(0.2), {Rotation = 0}):Play()
                        ConfigData[DropdownSettings.Name] = Option
                        SaveSettings()
                        pcall(DropdownSettings.Callback, Option)
                    end)
                end
                OptionList.Size = UDim2.new(1, 0, 0, #DropdownSettings.Options * 30)
            end
            RefreshList()
            if ConfigData[DropdownSettings.Name] then
                local SavedOption = ConfigData[DropdownSettings.Name]
                Title.Text = DropdownSettings.Name .. " - " .. SavedOption
                pcall(DropdownSettings.Callback, SavedOption)
            end
            DropBtn.MouseButton1Click:Connect(function()
                Open = not Open
                if Open then
                    local Height = 40 + (#DropdownSettings.Options * 30)
                    TweenService:Create(DropFrame, TweenInfo.new(0.2), {Size = UDim2.new(1, -5, 0, Height)}):Play()
                    TweenService:Create(Arrow, TweenInfo.new(0.2), {Rotation = 180}):Play()
                else
                    TweenService:Create(DropFrame, TweenInfo.new(0.2), {Size = UDim2.new(1, -5, 0, 40)}):Play()
                    TweenService:Create(Arrow, TweenInfo.new(0.2), {Rotation = 0}):Play()
                end
            end)
        end

        -- Element: TextBox
        function Tab:AddTextbox(TextboxSettings)
            local BoxFrame = Instance.new("Frame")
            BoxFrame.Parent = Page
            BoxFrame.BackgroundColor3 = Theme.Secondary
            BoxFrame.Size = UDim2.new(1, -5, 0, 40)
            Instance.new("UICorner", BoxFrame).CornerRadius = UDim.new(0, 6)
            local Title = Instance.new("TextLabel")
            Title.Parent = BoxFrame
            Title.BackgroundTransparency = 1
            Title.Position = UDim2.new(0, 10, 0, 0)
            Title.Size = UDim2.new(0.6, 0, 1, 0)
            Title.Font = Enum.Font.Gotham
            Title.Text = TextboxSettings.Name
            Title.TextColor3 = Theme.Text
            Title.TextSize = 14
            Title.TextXAlignment = Enum.TextXAlignment.Left
            local Input = Instance.new("TextBox")
            Input.Parent = BoxFrame
            Input.BackgroundColor3 = Theme.Main
            Input.Position = UDim2.new(1, -110, 0.5, -12)
            Input.Size = UDim2.new(0, 100, 0, 24)
            Input.Font = Enum.Font.Gotham
            Input.Text = TextboxSettings.Default or ""
            Input.PlaceholderText = "..."
            Input.TextColor3 = Theme.Accent
            Input.TextSize = 13
            Instance.new("UICorner", Input).CornerRadius = UDim.new(0, 4)
            Input.FocusLost:Connect(function(enterPressed)
                pcall(TextboxSettings.Callback, Input.Text)
                if TextboxSettings.TextDisappear then Input.Text = "" end
            end)
        end
        
        -- Element: Bind (Config Only)
        function Tab:AddBind(BindSettings)
            local BindFrame = Instance.new("Frame")
            BindFrame.Parent = Page
            BindFrame.BackgroundColor3 = Theme.Secondary
            BindFrame.Size = UDim2.new(1, -5, 0, 40)
            Instance.new("UICorner", BindFrame).CornerRadius = UDim.new(0, 6)
            local Title = Instance.new("TextLabel")
            Title.Parent = BindFrame
            Title.BackgroundTransparency = 1
            Title.Position = UDim2.new(0, 10, 0, 0)
            Title.Size = UDim2.new(0.6, 0, 1, 0)
            Title.Font = Enum.Font.Gotham
            Title.Text = BindSettings.Name
            Title.TextColor3 = Theme.Text
            Title.TextSize = 14
            Title.TextXAlignment = Enum.TextXAlignment.Left
            local KeyBtn = Instance.new("TextButton")
            KeyBtn.Parent = BindFrame
            KeyBtn.BackgroundColor3 = Theme.Main
            KeyBtn.Position = UDim2.new(1, -110, 0.5, -12)
            KeyBtn.Size = UDim2.new(0, 100, 0, 24)
            KeyBtn.Font = Enum.Font.GothamBold
            KeyBtn.Text = CurrentKeybind.Name
            KeyBtn.TextColor3 = Theme.Accent
            KeyBtn.TextSize = 12
            Instance.new("UICorner", KeyBtn).CornerRadius = UDim.new(0, 4)
            local Changing = false
            KeyBtn.MouseButton1Click:Connect(function()
                if Changing then return end
                Changing = true
                KeyBtn.Text = "..."
                local InputConnection
                InputConnection = UserInputService.InputBegan:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.Keyboard then
                        Changing = false
                        CurrentKeybind = input.KeyCode
                        KeyBtn.Text = input.KeyCode.Name
                        SaveSettings()
           
